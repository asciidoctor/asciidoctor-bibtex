#!/usr/bin/env ruby

# Executable for asciidoc-bib
#
# Provides some command line options for adding reference material 
# to asciidoc files, generating revised files for processing by 
# asciidoc.
#
# Copyright (c) Peter Lane, 2012.
# Released under Open Works License, 0.9.2

require 'asciidoc-bib'
require 'optparse'

include AsciidocBib

bibfile = ""

options = OptionParser.new do |opts|
  opts.banner = "Usage: asciidoc-bib filename"
  opts.on("-h", "--help", "help message") do |v|
    puts options
    exit!
  end
  opts.on("-b", "--bibfile FILE", "location of bib file") do |v|
    bibfile = v
  end
end

begin
  options.parse!
rescue
  puts options
  exit!
end

if bibfile.empty?
  bibfile = find_bibliography "."
  if bibfile.empty?
    bibfile = find_bibliography "#{ENV['HOME']}/Documents"
  end
end
if bibfile.empty?
  puts "Error: could not find a bibliography file"
  exit
end
puts "Reading biblio: #{bibfile}"

biblio = read_bibliography bibfile

cites_used = read_citations ARGV[0]
puts "Cites: #{cites_used.join(",")}"

add_citations(ARGV[0], cites_used, biblio)

